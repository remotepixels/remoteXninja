<html>
<head>
	<title>remotepixels.app</title>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
	<meta http-equiv="Pragma" content="no-cache"/>
	<meta http-equiv="Expires" content="0"/>
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#2e2e2e">
	<meta name="keywords" content="Gui Felix, Advertising, Visual Effects, Motion Graphics, Remote Pixels">
	<meta name="robots" content="index, follow">
    
	<link rel="apple-touch-icon" sizes="180x180" href="https://remotepixels.app/icons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://remotepixels.app/icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://remotepixels.app/icons/favicon-16x16.png">
	<link rel="manifest" href="https://remotepixels.app/icons/site.webmanifest">
	<link rel="mask-icon" href="https://remotepixels.app/icons/safari-pinned-tab.svg" color="#5bbad5">
	<link rel="shortcut icon" href="https://remotepixels.app/icons/favicon.ico">

	<link rel="stylesheet" href="style.css">
</head>
    
<body style="background-color: #2e2e2e;">

<!-- top navbar for portfolio-->
	<div class="topnav" id="topnav">
		<image src="images/icon.png" height="44" width="44" style="margin-left:40px; margin-top: 10px;"/>
		<div class="navbar">
			<a href="https://remotepixels.myportfolio.com" target="inset_window" style="margin-right: 30px;"> PORTFOLIO </a>  
			<a href="https://remotepixels.myportfolio.com/copy-of-work" target="inset_window" style="margin-right: 30px;"> BEFORE / AFTER </a> 
			<a href="https://remotepixels.myportfolio.com/contact" target="inset_window" style="margin-right: 120px;"> CONTACT </a> 
			<div class="liveSessionIcon" id="liveSessionIcon" style="font: 14px Arial; font-weight: bold; text-align: center; margin-top: 0px;">LIVE</div>
		</div>
	</div>

<!-- top navbar for live session -->    
	<div class="topnav" id="subNav" style="display: none;">
		<image src="images/icon.png" height="44" width="44" style="margin-left:40px; margin-top: 10px;"/>
		<div class="ninjaIcon" style="right: 300px;"> 
         		<a href="https://vdo.ninja" target="_blank" style="color: black;"> POWERED BY VDO.NINJA <img src="images/ninja.png" width="23" height="23"/> </a>
        	</div>
        	<div id="clock" style="position: absolute; right: 226px; margin-right:0px; margin-top: -34px; font: 24px Arial; font-weight: 200;"></div>	
        	<div class="endSessionIcon" id="endSessionIcon" onclick="location.replace('https://remotepixels.app');" style="font: 14px Arial; font-weight: bold; text-align: center; margin-top: 2px;">LEAVE SESSION </div>
	</div>
		
<!--load portfolio from behance-->
	<iframe src="https://remotepixels.myportfolio.com" class="portfolio" name="inset_window" id="inset_window"></iframe>

<!--popup window things-->
<!--darken screen for popups-->
	<div class="blackout" id="blackout">

<!--fade and slide in popup window-->
		<div class="popupGroup" id="popupGroup"> 
            
<!--popup window, draws the white popup window-->
			<div class="popupWindow" id="popupWindow">
                
<!--popup window content : live session ID--> 
               			<div class="sessionIDpopupContent" id="sessionIDpopupContent")>
                    			<div class="popupIcon"><img src=images/icon_round_live.png></div>
				    	<div class="popupTitle">Enter live session ID</div>
	
				    	<form id="sessionIDCode" name="sessionIDCode" onsubmit="return validateSessionID()" method="post" required>
						&emsp;&nbsp;
					    	<input class="sessionOTP" type="text" oninput='digitValidate(this)' onkeyup='this.value = this.value.toUpperCase(); tabChange(1)' maxlength=1 name=v1>
					    	<input class="sessionOTP" type="text" oninput='digitValidate(this)' onkeyup='this.value = this.value.toUpperCase(); tabChange(2)' maxlength=1 name=v2>
					    	<input class="sessionOTP" type="text" oninput='digitValidate(this)' onkeyup='this.value = this.value.toUpperCase(); tabChange(3)' maxlength=1 name=v3>
						&emsp;
					    	<input class="sessionOTP" type="text" oninput='digitValidate(this)' onkeyup='this.value = this.value.toUpperCase(); tabChange(4)' maxlength=1 name=v4>
					    	<input class="sessionOTP" type="text" oninput='digitValidate(this)' onkeyup='this.value = this.value.toUpperCase(); tabChange(5)' maxlength=1 name=v5>
					    	<input class="sessionOTP" type="text" oninput='digitValidate(this)' onkeyup='this.value = this.value.toUpperCase(); tabChange(6)' maxlength=1 name=v6>
						<br>
						<input type="submit" value="Next" class=button>
				    	</form>
			   	 </div>
             
<!--popup window content : ask for a username--> 
				<div class="askNamePopupContent" id="askNamePopupContent")>
					<div class="popupIcon"><img src=images/icon_round_user.png></div>
					<div class="popupTitle">Enter your stage name</div>
	
					<form id="stageName" name="stageName" action="" onsubmit="return validateStageName()" method="post" required>
						<input class="enterStageName" type="text" maxlength=50 name=enterStageName>
						<div class="popupTitle" style="font-size: 14px; margin-top: 6px; color: grey;"> * This name will be visible to other users.<p>If you wish to chat with others you must allow<br>microphone access when prompted.</div>   
						<input type="submit" value="Join" class=button style="margin-top: 10px;">                            
					</form>
				</div>                    
			</div>
		</div>
	</div>
</body>

<script type="text/javascript">  
var cookieStoredName;    
var sessionFile;
var encodedStagename;

//check if there is a live session otherwise hide live session button
//using fetch so done asynchronously while loading page
fetch("https://remotepixels.app/Alive.txt")
	.then( response => {
	if (response.ok) {
		liveSessionIcon.style.display = "inline";
	}
	return;
	})

//cookie bits
//checks if cookie exists and stores the value in cookieStoredName
let user = getCookie("username");
if (user != "") {
	cookieStoredName = user;
	}
    
//sets cookie with the users name (encodedStageName) and lets it expire in 24 hours (86400*1000 milisconds
function setCookie(cname,cvalue) {
	let expires = "expires=" + (new Date(Date.now()+ 30000)).toUTCString(); //set cookie for 30 seconds to test
	document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	return;
	}

//read cookie username value
function getCookie(cname) {
	let name = cname + "=";
	let decodedCookie = decodeURIComponent(document.cookie);
	let ca = decodedCookie.split(';');
	for(let i = 0; i < ca.length; i++) {
		let c = ca[i];
		while (c.charAt(0) == ' ') {
			c = c.substring(1);
			}
		if (c.indexOf(name) == 0) {
			return c.substring(name.length, c.length);
			}
		}
  	return "";
	}

//check if an URL parameter is sent
//if an url parameter is valid and there is no cookie then ask for a username
//if an url parameter is valid and there is a cookie then login automatically
let query = location.search;
if  (query != 0) {
	let sessionID = query.slice(1);
        const request = new XMLHttpRequest();
        request.open("GET", "https://remotepixels.app/Alive"+sessionID+".txt", false); // `false` makes the request synchronous
        request.send(null);

	if (request.status === 200 && cookieStoredName == "" || cookieStoredName == null) {
                blackout.style.display = "block";
                sessionIDpopupContent.style.animation = "fadeOut 300ms";
		setTimeout ( function () {sessionIDpopupContent.style.animation = "none"; sessionIDpopupContent.style.display = "none";}, 300);
		askNamePopupContent.style.animation = "fadeIn 300ms ease-out";
		setTimeout(function () { askNamePopupContent.style.display = "block"; document.forms["stageName"]["enterStageName"].focus();}, 300);
                sessionFile = sessionID
		}
 	else if (request.status === 200 && cookieStoredName != "" || cookieStoredName == null) {
                blackout.style.animation = "fadeOut 500ms ease-out";
		setTimeout(function () { blackout.style.animation = "none"; blackout.style.display = "none";}, 500);        
                document.getElementById("topnav").style.display = "none";
                document.getElementById("subNav").style.display = "block";
                startTime ();
                loadNinja ();
		}         

	}
    
//clock for top right of user session
function startTime() {
	const today = new Date();
        let h = today.getHours();
        let m = today.getMinutes();
        m = checkTime(m);
        document.getElementById('clock').innerHTML =  h + ":" + m ;
        setTimeout(startTime, 1000);
	}

function checkTime(i) {
        if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
        return i;
        }    

//popup live session window if the live button is clicked
liveSessionIcon.onclick = function() {
	blackout.style.animation = "fadeIn 500ms ease-out";
	blackout.style.display = "block";
	setTimeout(function () { blackout.style.animation = "none";}, 300);
        document.forms["sessionIDCode"]["v1"].focus();
	}
  			
//hide live session window when user clicks off
window.onclick = function(event) {
	if (event.target == blackout || event.target == popupGroup) {
	blackout.style.animation = "fadeOut 300ms ease-out";
	setTimeout(function () { blackout.style.animation = "none"; blackout.style.display = "none"; }, 300);}
	}

//Live Session ID check need to re-write this, bit crap
//replace lowercase letters with uppercase, make sure no funny characters
let digitValidate = function(ele){
	console.log(ele.value);
	ele.value = ele.value.replace(/[^0-9a-zA-Z]/g,'');
	}

//if valid input move to next input box
let tabChange = function(val){
	let ele = document.querySelectorAll('input');
	if (ele[val-1].value != '') {
		ele[val].focus()
		}
	else if (ele[val-1].value == '') {
		ele[val-2].focus()
		}   
	}
   
    
//validates the session ID
//on submit, check there are no blank (no value) fields
function validateSessionID(){
	let v1 = document.forms ["sessionIDCode"]["v1"].value;
	let v2 = document.forms ["sessionIDCode"]["v2"].value;
	let v3 = document.forms ["sessionIDCode"]["v3"].value;
	let v4 = document.forms ["sessionIDCode"]["v4"].value;
	let v5 = document.forms ["sessionIDCode"]["v5"].value;
	let v6 = document.forms ["sessionIDCode"]["v6"].value;
        
	//if there are empty fields shake the box and clear it
	if (!v1 || !v2 || !v3 || !v4 || !v5 || !v6) {
		popupWindow.style.animation = "shake 500ms";
		setTimeout ( function () {popupWindow.style.animation = "none"; document.getElementById("sessionIDCode").reset();}, 300);
		document.forms["sessionIDCode"]["v1"].focus();
		return false;
		}
	else {
		sessionFile = v1+v2+v3+v4+v5+v6;
		}
        
	//check to see if the session ID entered exists
	//done synchronous to make sure we get the file before checking
	const request = new XMLHttpRequest();
	request.open("GET", "https://remotepixels.app/Alive"+sessionFile+".txt", false); // `false` makes the request synchronous
	request.send(null);

	//if the sessionID entered matches the file on the server fade out the sessionID and ask for a username
	if (request.status === 200) {
		sessionIDpopupContent.style.animation = "fadeOut 300ms";
		setTimeout ( function () {sessionIDpopupContent.style.animation = "none"; sessionIDpopupContent.style.display = "none";}, 300);
		askNamePopupContent.style.animation = "fadeIn 300ms ease-out";
		setTimeout(function () { askNamePopupContent.style.display = "block"; document.forms["stageName"]["enterStageName"].focus();}, 300);
                return false;
                }
	//and the sessionID does not match the file on server
	else {
		popupWindow.style.animation = "shake 500ms";
		setTimeout ( function () {popupWindow.style.animation = "none"; document.getElementById("sessionIDCode").reset();}, 300);
		document.forms["sessionIDCode"]["v1"].focus();
                return false;
                } 
	return false;
	} 
        
//make sure stage name isn't empty, then clean up the string so if any funny characters it doesn't screw up the rest
function validateStageName(){
	let v1 = document.forms ["stageName"]["enterStageName"].value;
        if (!v1) {
		popupWindow.style.animation = "shake 500ms";
		setTimeout ( function () {popupWindow.style.animation = "none"; document.forms["stageName"]["enterStageName"].focus(); }, 300);  
		return false;
	}
          
        let uri = document.forms ["stageName"]["enterStageName"].value;
        encodedStagename = encodeURIComponent(uri);
 
	//fade out popup, and hide top navigation
        blackout.style.animation = "fadeOut 500ms ease-out";
	setTimeout(function () { blackout.style.animation = "none"; blackout.style.display = "none";}, 500);        
        document.getElementById("topnav").style.display = "none";

	//load session sub nav
        document.getElementById("subNav").style.display = "block";
      
	//Set the username cookie for future so don't have to keep asking for name
        setCookie("username", encodedStagename);
        startTime ();
        loadNinja ();
        }
    
    
//load vdo.ninja client session with the sessionFile and the encodedStageName into the iframe with all parameters, this is what it's all about   
function loadNinja () {
	document.getElementById("inset_window").allow = "document-domain;encrypted-media;sync-xhr;usb;web-share;cross-origin-isolated;accelerometer;midi;geolocation;autoplay;camera;microphone;fullscreen;picture-in-picture;display-capture;";
	document.getElementById("inset_window").src = "https://remotepixels.github.io/remotepixels.app/?room=RemotePixels_"+sessionFile+"&label="+encodedStagename+"&favicon=https%3A%2F%2Fremotepixels.app%2Ficons%2Ffavicon.ico&darkmode&noheader&hidehome&hidetranslate&autostart&easyexit&videodevice=0&audiodevice=1&miconly&miconlyoption&nopreview&broadcast&quality=0&margin=10&chroma=2e2e2e&hiddenscenebitrate=10000&signalmeter&chatbutton=0&nofileshare&nospeakerbutton&notify&disablehotkeys&cleanviewer&hideplaybutton&nosettings&novideobutton&nocontrols&showlist=1&sync=-200&css=https://remotepixels.app/ninja.css&nohangupbutton";     

	}
</script>
</html>
</html>
